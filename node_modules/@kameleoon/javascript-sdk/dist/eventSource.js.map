{"version":3,"file":"eventSource.js","names":["EventSourceConstructor","a","_classCallCheck","_createClass","key","value","initialize","url","ExternalEventSource","exports","_defineProperty","eventSource","EventSource","open","siteCode","eventType","onEvent","addEventListener","message","event","JSON","parse","data","eventSiteCode","ts","close"],"sources":["../src/eventSource.ts"],"sourcesContent":["import {\n  RealTimeEventType,\n  IExternalEventSource,\n  EventSourceOpenParametersType,\n  IExternalEventSourceConstructor,\n} from '@kameleoon/javascript-sdk-core';\n\nexport class EventSourceConstructor implements IExternalEventSourceConstructor {\n  public initialize(url: string): IExternalEventSource {\n    return new ExternalEventSource(url);\n  }\n}\n\n// --- Note ---\n// - `EventSource` has no dedicated tests because same browser instance\n// is tested thoroughly inside core and would just duplicate tests\n// - Moreover we would have to import some unexposed details like constructed url\n// or the `eventType` from the core\nclass ExternalEventSource implements IExternalEventSource {\n  private eventSource: EventSource;\n\n  constructor(url: string) {\n    const eventSource = new EventSource(url);\n\n    this.eventSource = eventSource;\n  }\n\n  public open({\n    siteCode,\n    eventType,\n    onEvent,\n  }: EventSourceOpenParametersType): void {\n    this.eventSource.addEventListener(eventType, (message) => {\n      const event: RealTimeEventType = JSON.parse(message.data);\n      const { siteCode: eventSiteCode, ts } = event;\n\n      if (siteCode === eventSiteCode) {\n        onEvent(ts);\n      }\n    });\n  }\n\n  public close() {\n    this.eventSource.close();\n  }\n}\n"],"mappings":"s1CAOa,CAAAA,sBAAsB,kCAAAC,EAAA,EAAAC,eAAA,MAAAD,CAAA,SAAAE,YAAA,CAAAF,CAAA,GAAAG,GAAA,cAAAC,KAAA,CACjC,SAAAC,WAAkBC,CAAW,CAAwB,CACnD,MAAO,IAAI,CAAAC,mBAAmB,CAACD,CAAG,CACpC,CAAC,IAAAN,CAAA,IAGH;AACA;AACA;AACA;AACA;AAAAQ,OAAA,CAAAT,sBAAA,CAAAA,sBAAA,IACM,CAAAQ,mBAAmB,yBAGvB,SAAAP,EAAYM,CAAW,CAAE,CAAAL,eAAA,MAAAD,CAAA,EAAAS,eAAA,4BACvB,GAAM,CAAAC,CAAW,CAAG,GAAI,CAAAC,WAAW,CAACL,CAAG,CAAC,CAExC,IAAI,CAACI,WAAW,CAAGA,CACrB,CAAC,OAAAR,YAAA,CAAAF,CAAA,GAAAG,GAAA,QAAAC,KAAA,CAED,SAAAQ,KAAAZ,CAAA,CAIwC,IAHtC,CAAAa,CAAQ,CAAAb,CAAA,CAARa,QAAQ,CACRC,CAAS,CAAAd,CAAA,CAATc,SAAS,CACTC,CAAO,CAAAf,CAAA,CAAPe,OAAO,CAEP,IAAI,CAACL,WAAW,CAACM,gBAAgB,CAACF,CAAS,CAAE,SAACG,CAAO,CAAK,IAClD,CAAAC,CAAwB,CAAGC,IAAI,CAACC,KAAK,CAACH,CAAO,CAACI,IAAI,CAAC,CACvCC,CAAa,CAASJ,CAAK,CAArCL,QAAQ,CAAiBU,CAAE,CAAKL,CAAK,CAAZK,EAAE,CAE/BV,CAAQ,GAAKS,CAAa,EAC5BP,CAAO,CAACQ,CAAE,CAEd,CAAC,CACH,CAAC,GAAApB,GAAA,SAAAC,KAAA,CAED,SAAAoB,MAAA,CAAe,CACb,IAAI,CAACd,WAAW,CAACc,KAAK,EACxB,CAAC,IAAAxB,CAAA"}