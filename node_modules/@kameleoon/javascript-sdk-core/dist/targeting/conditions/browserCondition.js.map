{"version":3,"file":"browserCondition.js","names":["BrowserCondition","a","b","browser","version","versionMatchType","_classCallCheck","_defineProperty","_createClass","key","value","evaluate","targetingData","browserData","KameleoonData","Browser","result","checkCondition","error","Err","Ok","parsedVersion","parseFloat","isNaN","KameleoonError","KameleoonException","VersionParse","VersionMatchType","EQUAL","GREATER","LOWER","exhaustCheck","exports"],"sources":["../../../src/targeting/conditions/browserCondition.ts"],"sourcesContent":["import { Err, Ok, Result } from 'ts-res';\nimport { KameleoonData, BrowserType, BrowserDataType } from 'src/kameleoonData';\nimport {\n  exhaustCheck,\n  KameleoonError,\n  KameleoonException,\n} from 'src/kameleoonError';\nimport { EvaluationDataType, VersionMatchType } from 'src/targeting/types';\nimport { ConditionDataType, ICondition } from './types';\n\nexport class BrowserCondition implements ICondition {\n  private browser?: BrowserType | null;\n  private version?: string | null;\n  private versionMatchType?: VersionMatchType | null;\n  private error?: KameleoonError;\n\n  constructor({ browser, version, versionMatchType }: ConditionDataType) {\n    this.browser = browser;\n    this.version = version;\n    this.versionMatchType = versionMatchType;\n  }\n\n  public evaluate({\n    targetingData,\n  }: EvaluationDataType): Result<boolean, KameleoonError> {\n    const browserData = targetingData?.[KameleoonData.Browser];\n\n    if (browserData) {\n      const result = this.checkCondition(browserData);\n\n      if (this.error) {\n        return Err(this.error);\n      }\n\n      return Ok(result);\n    }\n\n    return Ok(false);\n  }\n\n  private checkCondition(browserData: BrowserDataType): boolean {\n    const { browser, version } = browserData;\n\n    if (typeof this.browser !== 'string') {\n      return false;\n    }\n\n    if (typeof this.version !== 'string') {\n      return browser === this.browser;\n    }\n\n    if (!this.versionMatchType || typeof version !== 'number') {\n      return false;\n    }\n\n    const parsedVersion = parseFloat(this.version);\n\n    if (isNaN(parsedVersion)) {\n      this.error = new KameleoonError(\n        KameleoonException.VersionParse,\n        this.version,\n      );\n    }\n\n    switch (this.versionMatchType) {\n      case VersionMatchType.EQUAL:\n        return browser === this.browser && version === parsedVersion;\n      case VersionMatchType.GREATER:\n        return browser === this.browser && version > parsedVersion;\n      case VersionMatchType.LOWER:\n        return browser === this.browser && version < parsedVersion;\n      default:\n        exhaustCheck(this.versionMatchType);\n    }\n  }\n}\n"],"mappings":"s+CAUa,CAAAA,gBAAgB,yBAM3B,SAAAC,EAAAC,CAAA,CAAuE,IAAzD,CAAAC,CAAO,CAAAD,CAAA,CAAPC,OAAO,CAAEC,CAAO,CAAAF,CAAA,CAAPE,OAAO,CAAEC,CAAgB,CAAAH,CAAA,CAAhBG,gBAAgB,CAAAC,eAAA,MAAAL,CAAA,EAAAM,eAAA,wBAAAA,eAAA,wBAAAA,eAAA,iCAAAA,eAAA,sBAC9C,IAAI,CAACJ,OAAO,CAAGA,CAAO,CACtB,IAAI,CAACC,OAAO,CAAGA,CAAO,CACtB,IAAI,CAACC,gBAAgB,CAAGA,CAC1B,CAAC,OAAAG,YAAA,CAAAP,CAAA,GAAAQ,GAAA,YAAAC,KAAA,CAED,SAAAC,SAAAV,CAAA,CAEwD,IADtD,CAAAW,CAAa,CAAAX,CAAA,CAAbW,aAAa,CAEPC,CAAW,QAAGD,CAAa,WAAbA,CAAa,QAAbA,CAAa,CAAGE,4BAAa,CAACC,OAAO,CAAC,CAE1D,GAAIF,CAAW,CAAE,CACf,GAAM,CAAAG,CAAM,CAAG,IAAI,CAACC,cAAc,CAACJ,CAAW,CAAC,CAAC,MAE5C,KAAI,CAACK,KAAK,CACL,GAAAC,UAAG,EAAC,IAAI,CAACD,KAAK,CAAC,CAGjB,GAAAE,SAAE,EAACJ,CAAM,CAClB,CAEA,MAAO,GAAAI,SAAE,KACX,CAAC,GAAAX,GAAA,kBAAAC,KAAA,CAED,SAAAO,eAAuBJ,CAA4B,CAAW,CAC5D,GAAQ,CAAAV,CAAO,CAAcU,CAAW,CAAhCV,OAAO,CAAEC,CAAO,CAAKS,CAAW,CAAvBT,OAAO,CAExB,GAA4B,QAAQ,EAAhC,MAAO,KAAI,CAACD,OAAoB,CAClC,SAGF,GAA4B,QAAQ,EAAhC,MAAO,KAAI,CAACC,OAAoB,CAClC,MAAO,CAAAD,CAAO,GAAK,IAAI,CAACA,OAAO,CAGjC,GAAI,CAAC,IAAI,CAACE,gBAAgB,EAAuB,QAAQ,EAA3B,MAAO,CAAAD,CAAoB,CACvD,SAGF,GAAM,CAAAiB,CAAa,CAAGC,UAAU,CAAC,IAAI,CAAClB,OAAO,CAAC,CAS9C,OAPImB,KAAK,CAACF,CAAa,CAAC,GACtB,IAAI,CAACH,KAAK,CAAG,GAAI,CAAAM,8BAAc,CAC7BC,kCAAkB,CAACC,YAAY,CAC/B,IAAI,CAACtB,OAAO,CACb,EAGK,IAAI,CAACC,gBAAgB,EAC3B,IAAK,CAAAsB,uBAAgB,CAACC,KAAK,CACzB,MAAO,CAAAzB,CAAO,GAAK,IAAI,CAACA,OAAO,EAAIC,CAAO,GAAKiB,CAAa,CAC9D,IAAK,CAAAM,uBAAgB,CAACE,OAAO,CAC3B,MAAO,CAAA1B,CAAO,GAAK,IAAI,CAACA,OAAO,EAAIC,CAAO,CAAGiB,CAAa,CAC5D,IAAK,CAAAM,uBAAgB,CAACG,KAAK,CACzB,MAAO,CAAA3B,CAAO,GAAK,IAAI,CAACA,OAAO,EAAIC,CAAO,CAAGiB,CAAa,CAC5D,QACE,GAAAU,4BAAY,EAAC,IAAI,CAAC1B,gBAAgB,CAAC,CAAC,CAE1C,CAAC,IAAAJ,CAAA,IAAA+B,OAAA,CAAAhC,gBAAA,CAAAA,gBAAA"}