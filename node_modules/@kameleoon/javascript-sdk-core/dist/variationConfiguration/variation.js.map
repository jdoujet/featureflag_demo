{"version":3,"file":"variation.js","names":["_types","require","Object","defineProperty","exports","value","Variation","_typeof","a","Symbol","iterator","constructor","prototype","_classCallCheck","b","TypeError","_defineProperties","c","d","length","enumerable","configurable","writable","_toPropertyKey","key","_createClass","_defineProperty","_toPrimitive","toPrimitive","call","String","Number","variationData","get","Error","variationId","isValid","respoolTime","variation","assignmentTime","Date","parse","assignmentDate","getTime","Milliseconds","Second","variationRespoolTime","find","respool"],"sources":["../../src/variationConfiguration/variation.ts"],"sourcesContent":["import { RespoolTimeType } from 'src/campaignConfiguration/types';\nimport { Milliseconds } from 'src/types';\nimport { VariationType } from './types';\n\ninterface IVariation {\n  readonly id: number;\n  isValid: (respoolTime?: RespoolTimeType[]) => boolean;\n}\n\nexport class Variation implements IVariation {\n  variationData?: VariationType;\n\n  constructor(variationData?: VariationType) {\n    this.variationData = variationData;\n  }\n\n  get id(): number {\n    if (!this.variationData) {\n      throw new Error(\n        \"Internal usage error: Check if the variation `isValid`, before getting it's `id`\",\n      );\n    }\n\n    return this.variationData.variationId;\n  }\n\n  public isValid(respoolTime?: RespoolTimeType[]): boolean {\n    const variation = this.variationData;\n\n    if (!variation) {\n      return false;\n    }\n\n    // --- Note ---\n    // - Respool is a kind of shuffle parameter\n    // it's presence indicates that variations assigned to\n    // user has changed at certain time (time is the value of `respoolTime` in seconds)\n    // - So the variation is valid unless it has been shuffled after it's assignment\n    if (respoolTime?.length) {\n      const assignmentTime =\n        new Date(Date.parse(variation.assignmentDate)).getTime() /\n        Milliseconds.Second;\n      const variationRespoolTime = respoolTime.find(\n        (respool) => respool.variationId === String(variation.variationId),\n      );\n\n      if (!variationRespoolTime) {\n        return true;\n      }\n\n      return assignmentTime > variationRespoolTime.value;\n    }\n\n    return true;\n  }\n}\n"],"mappings":"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"}