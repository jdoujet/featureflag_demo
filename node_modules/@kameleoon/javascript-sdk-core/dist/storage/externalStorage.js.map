{"version":3,"file":"externalStorage.js","names":["ExternalStorage","a","externalStorage","_classCallCheck","_defineProperty","key","storage","_createClass","value","read","result","ok","parse","data","write","JSON","stringify","Ok","err","KameleoonError","KameleoonException","StorageParse","exports"],"sources":["../../src/storage/externalStorage.ts"],"sourcesContent":["import { Ok, Result } from 'ts-res';\nimport { KameleoonError, KameleoonException } from 'src/kameleoonError';\nimport { IExternalStorage, IStorage, StorageDataType } from './types';\nimport { KameleoonStorageKey } from './constants';\n\nexport class ExternalStorage<T extends StorageDataType> implements IStorage<T> {\n  private key: KameleoonStorageKey;\n  private storage: IExternalStorage;\n\n  constructor(externalStorage: IExternalStorage) {\n    this.key = externalStorage.key;\n    this.storage = externalStorage;\n  }\n\n  public read(): Result<T, KameleoonError> {\n    const result = this.storage.read();\n\n    if (!result.ok) {\n      return result;\n    }\n\n    return this.parse(result.data);\n  }\n\n  public write(data: T): Result<void, KameleoonError> {\n    this.storage.write(JSON.stringify(data));\n\n    return Ok();\n  }\n\n  private parse(data: string): Result<T, KameleoonError> {\n    let result: T;\n\n    try {\n      result = JSON.parse(data);\n    } catch (err) {\n      throw new KameleoonError(KameleoonException.StorageParse, err, this.key);\n    }\n\n    return Ok(result);\n  }\n}\n"],"mappings":"y5CAKa,CAAAA,eAAe,yBAI1B,SAAAC,EAAYC,CAAiC,CAAE,CAAAC,eAAA,MAAAF,CAAA,EAAAG,eAAA,oBAAAA,eAAA,wBAC7C,IAAI,CAACC,GAAG,CAAGH,CAAe,CAACG,GAAG,CAC9B,IAAI,CAACC,OAAO,CAAGJ,CACjB,CAAC,OAAAK,YAAA,CAAAN,CAAA,GAAAI,GAAA,QAAAG,KAAA,CAED,SAAAC,KAAA,CAAyC,CACvC,GAAM,CAAAC,CAAM,CAAG,IAAI,CAACJ,OAAO,CAACG,IAAI,EAAE,CAAC,MAE9B,CAAAC,CAAM,CAACC,EAAE,CAIP,IAAI,CAACC,KAAK,CAACF,CAAM,CAACG,IAAI,CAAC,CAHrBH,CAIX,CAAC,GAAAL,GAAA,SAAAG,KAAA,CAED,SAAAM,MAAaD,CAAO,CAAgC,CAGlD,MAFA,KAAI,CAACP,OAAO,CAACQ,KAAK,CAACC,IAAI,CAACC,SAAS,CAACH,CAAI,CAAC,CAAC,CAEjC,GAAAI,SAAE,GACX,CAAC,GAAAZ,GAAA,SAAAG,KAAA,CAED,SAAAI,MAAcC,CAAY,CAA6B,CACrD,GAAI,CAAAH,CAAS,CAEb,GAAI,CACFA,CAAM,CAAGK,IAAI,CAACH,KAAK,CAACC,CAAI,CAC1B,CAAE,MAAOK,CAAG,CAAE,CACZ,KAAM,IAAI,CAAAC,8BAAc,CAACC,kCAAkB,CAACC,YAAY,CAAEH,CAAG,CAAE,IAAI,CAACb,GAAG,CACzE,CAEA,MAAO,GAAAY,SAAE,EAACP,CAAM,CAClB,CAAC,IAAAT,CAAA,IAAAqB,OAAA,CAAAtB,eAAA,CAAAA,eAAA"}