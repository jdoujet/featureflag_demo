{"version":3,"file":"cacheManager.js","names":["_types","require","Object","defineProperty","exports","value","CacheManager","_typeof","a","Symbol","iterator","constructor","prototype","_slicedToArray","b","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","c","d","e","f","g","h","i","j","call","next","done","push","length","return","Array","isArray","_createForOfIteratorHelper","s","n","_arrayLikeToArray","toString","slice","name","from","test","_classCallCheck","_defineProperties","enumerable","configurable","writable","_toPropertyKey","key","_createClass","_defineProperty","_toPrimitive","toPrimitive","String","Number","cleanupTimeout","Map","Milliseconds","Second","add","data","lifetime","intervalId","activate","expirationTime","cacheItem","Date","now","cacheMap","set","getAliveItem","get","delete","setInterval","item","size","cleanupInterval","clearInterval"],"sources":["../../src/cacheManager/cacheManager.ts"],"sourcesContent":["import { Milliseconds } from 'src/types';\nimport { AddParametersType, CacheItemType } from './types';\n\ninterface ICacheManager<T> {\n  /**\n   * Add item to cache\n   * @param {AddParametersType<T>} parameters - parameters for adding new item cache\n   * @returns {void}\n   */\n  add({ key, data, lifetime }: AddParametersType<T>): void;\n  /**\n   * Get item that is not expired from cache\n   * @param {string} key - key of item\n   * @returns {T} an item that is not expired\n   */\n  getAliveItem(key: string): T | null;\n}\n\n/**\n * @class\n * CacheManager - a class for managing cache\n */\nexport class CacheManager<T> implements ICacheManager<T> {\n  private cacheMap = new Map<string, CacheItemType<T>>();\n  private intervalId: NodeJS.Timeout | null = null;\n  private cleanupTimeout: number;\n\n  /**\n   * @param {number} cleanupTimeout - timeout for cleaning cache in seconds\n   * generic type `T` is a type of data that will be stored in cache\n   * @example\n   * ```typescript\n   * const cacheManager = new CacheManager<number>(60);\n   * ```\n   */\n  constructor(cleanupTimeout: number) {\n    this.cleanupTimeout = cleanupTimeout * Milliseconds.Second;\n  }\n\n  public add({ key, data, lifetime }: AddParametersType<T>): void {\n    if (this.intervalId === null) {\n      this.activate();\n    }\n\n    const expirationTime = lifetime * Milliseconds.Second;\n\n    const cacheItem: CacheItemType<T> = {\n      data,\n      expirationTime: Date.now() + expirationTime,\n    };\n\n    this.cacheMap.set(key, cacheItem);\n  }\n\n  public getAliveItem(key: string): T | null {\n    const cacheItem = this.cacheMap.get(key);\n\n    if (cacheItem && cacheItem.expirationTime >= Date.now()) {\n      return cacheItem.data;\n    }\n\n    cacheItem && this.cacheMap.delete(key);\n\n    return null;\n  }\n\n  private activate(): void {\n    this.intervalId = setInterval(() => {\n      const now = Date.now();\n\n      for (const [key, item] of this.cacheMap) {\n        if (item.expirationTime < now) {\n          this.cacheMap.delete(key);\n        }\n      }\n\n      if (!this.cacheMap.size) {\n        this.cleanupInterval();\n      }\n    }, this.cleanupTimeout);\n  }\n\n  private cleanupInterval(): void {\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n      this.intervalId = null;\n    }\n  }\n}\n"],"mappings":"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"}